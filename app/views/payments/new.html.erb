<div class="container">
  <div class="row justify-content-center">
    <div class="m-5 bg-white col-xs-12 col-sm-12 col-md-8 col-lg-6 col-sm-offset-4">
      <div class="col">
        <h1>Order Details</h1>

        <ul class="list-group">
          <% @order.bid.bid_products.each do |bid_product| %>
            <li class="list-group-item">
              <div class="d-flex justify-content-between">
                <span><%= bid_product.quantity %></span>
                <span><%= bid_product.product.description %></span>
                <span><%= number_to_currency(bid_product.unit_price, unit: "R$ ", separator: ",", delimiter: "") %></span>
                <span><%= number_to_currency(bid_product.unit_price * bid_product.quantity, unit: "R$ ", separator: ",", delimiter: "") %></span>
              </div>
            </li>
          <% end %>
        </ul>

        <p>Total: <strong><%= number_to_currency(@order.amount, unit: "R$ ", separator: ",", delimiter: "") %></strong></p>

        <button id="pay" class="btn btn-primary">Payment</button>
        <script src="https://js.stripe.com/v3/"></script>

        <script>
          const paymentButton = document.getElementById('pay');
          paymentButton.addEventListener('click', () => {
            const stripe = Stripe('<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>');
            stripe.redirectToCheckout({
              sessionId: '<%= @order.checkout_session_id %>'
            });
          });
        </script>

      </div>
    </div>
  </div>
  <%= render 'shared/control_footer' %>
</div>
